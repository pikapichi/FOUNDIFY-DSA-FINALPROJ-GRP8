{% extends "base.html" %}

{% block title %}Report Lost Item{% endblock %}

{% block content %}
<div class="report-page">
    <div class="container">
        <h1>
    <span class="report-text">Report</span> 
    <span class="lost-text">Lost</span> 
    <span class="item-text">Item</span>
</h1>

        
        <div class="report-form-container">
            <form method="POST" action="{{ url_for('report_lost') }}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="name">Name :</label>
                    <input type="text" id="name" name="name" required autocomplete="off" oninput="autocomplete(this.value, 'lost')">
                    <div id="autocomplete-suggestions" class="autocomplete-dropdown"></div>
                </div>

                <div class="form-group">
                    <label for="category">Item :</label>
                    <input type="text" id="category" name="category" required placeholder="e.g., Phone, Wallet, Keys">
                </div>

                <div class="form-group">
                    <label for="location">Last seen :</label>
                    <select id="location" name="location" required>
                        <option value="">Select location</option>
                        <option value="Library">Library</option>
                        <option value="Cafeteria">Cafeteria</option>
                        <option value="Gym">Gym</option>
                        <option value="Classroom Building A">Classroom Building A</option>
                        <option value="Classroom Building B">Classroom Building B</option>
                        <option value="Parking Lot">Parking Lot</option>
                        <option value="Sports Complex">Sports Complex</option>
                        <option value="Dormitory">Dormitory</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">Date :</label>
                    <input type="date" id="date" name="date" value="{{ today }}" required>
                </div>

                <div class="form-group">
                    <label for="desc">Item Description :</label>
                    <textarea id="desc" name="desc" required placeholder="Provide detailed description..."></textarea>
                </div>

                <div class="form-group">
                    <label for="photo">Upload Photo :</label>
                    <input type="file" id="photo" name="photo" accept="image/*">
                    <small>jpeg/jpg/png/webp (optional)</small>
                </div>

                <div class="form-actions">
                    <button type="reset" class="btn-reset">Reset</button>
                    <button type="submit" class="btn-submit">Submit</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
async function autocomplete(value, type) {
    if (value.length < 2) {
        document.getElementById('autocomplete-suggestions').style.display = 'none';
        return;
    }
    
    const response = await fetch(`/api/autocomplete?prefix=${value}&type=${type}`);
    const suggestions = await response.json();
    
    const dropdown = document.getElementById('autocomplete-suggestions');
    if (suggestions.length > 0) {
        dropdown.innerHTML = suggestions.map(s => 
            `<div class="suggestion-item" onclick="selectSuggestion('${s}')">${s}</div>`
        ).join('');
        dropdown.style.display = 'block';
    } else {
        dropdown.style.display = 'none';
    }
}

function selectSuggestion(value) {
    document.getElementById('name').value = value;
    document.getElementById('autocomplete-suggestions').style.display = 'none';
}

// Close dropdown when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.form-group')) {
        document.getElementById('autocomplete-suggestions').style.display = 'none';
    }
});
</script>
{% endblock %}

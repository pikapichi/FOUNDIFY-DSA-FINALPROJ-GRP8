{% extends "base.html" %}

{% block title %}Matches{% endblock %}

{% block content %}
<div class="matches-page">
    <div class="container">
        <h1>Potential Matches for Your Item</h1>
        
        <div class="original-item">
            <h2>Your {{ item_type|capitalize }} Item</h2>
            <div class="item-details">
                <p><strong>Name:</strong> {{ item.name }}</p>
                <p><strong>Category:</strong> {{ item.category }}</p>
                <p><strong>Location:</strong> {{ item.location }}</p>
                <p><strong>Date:</strong> {{ item.date }}</p>
                <p><strong>Description:</strong> {{ item.desc }}</p>
            </div>
        </div>

        {% if matches %}
        <h2 style="text-align: center; margin-bottom: 40px; font-size: 32px;">Found {{ matches|length }} Potential Match(es)</h2>
        
        <div class="matches-grid">
            {% for match in matches %}
            <div class="match-card">
                <div class="match-score">
                    <div class="score-circle">
                        {% if match.score %}
                            {{ match.score }}%
                        {% elif match['score'] %}
                            {{ match['score'] }}%
                        {% else %}
                            N/A
                        {% endif %}
                    </div>
                </div>
                
                {% set matched_item = match.item if match.item else match['item'] %}
                
                <div class="match-details">
    <h3>{{ matched_item.name }}</h3>
    <p><strong>Category:</strong> {{ matched_item.category }}</p>
    <p><strong>Location:</strong> {{ matched_item.location }}</p>
    <p><strong>Date:</strong> {{ matched_item.date }}</p>
    <p><strong>Reported by:</strong> {{ matched_item.reporter.name }}</p>  <!-- ðŸ‘ˆ CHANGE THIS LINE -->
    <p><strong>Description:</strong> {{ matched_item.desc[:150] }}{% if matched_item.desc|length > 150 %}...{% endif %}</p>
    
    {% if matched_item.photo %}
    <img src="{{ url_for('static', filename='uploads/' + matched_item.photo) }}" 
         alt="{{ matched_item.name }}" 
         style="width: 100%; margin-top: 16px; border-radius: 8px; max-height: 300px; object-fit: cover;">
    {% endif %}
</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-matches">
            <h3>No Matches Found</h3>
            <p>We couldn't find any potential matches for your item at this time.</p>
            <p>Don't worry! New items are added regularly. Check back soon or try searching manually in the {{ 'Found Items' if item_type == 'lost' else 'Lost Items' }} section.</p>
            <br>
            <a href="{{ url_for('found_items' if item_type == 'lost' else 'lost_items') }}" class="btn-primary" style="padding: 12px 32px; text-decoration: none; display: inline-block;">Browse {{ 'Found Items' if item_type == 'lost' else 'Lost Items' }}</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
